<!DOCTYPE html><html><head><meta charSet="utf-8"/><title>Security Audit · FlashBank Router</title><meta name="description" content="Security posture of the FlashBank Router (WETH-first architecture)"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="icon" href="/favicon.ico"/><meta name="next-head-count" content="5"/><link rel="preload" href="/_next/static/css/c18625e156088d89.css" as="style"/><link rel="stylesheet" href="/_next/static/css/c18625e156088d89.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-ec3334a2ed489196.js" defer=""></script><script src="/_next/static/chunks/framework-945b357d4a851f4b.js" defer=""></script><script src="/_next/static/chunks/main-00f9ddc8cb2b4613.js" defer=""></script><script src="/_next/static/chunks/pages/_app-1dc02c47a09ca5ea.js" defer=""></script><script src="/_next/static/chunks/9147-c0e438f01b1889ce.js" defer=""></script><script src="/_next/static/chunks/pages/security-audit-5cfd495792bea239.js" defer=""></script><script src="/_next/static/sd4-ywU21MzRMPpMbbUnn/_buildManifest.js" defer=""></script><script src="/_next/static/sd4-ywU21MzRMPpMbbUnn/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="min-h-screen bg-white"><header class="bg-white border-b border-gray-200"><div class="container mx-auto px-6 py-4 flex justify-between items-center"><a class="flex items-center space-x-2 text-blue-600 hover:text-blue-800" href="/"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"></path></svg><span class="font-medium">Back to App</span></a><span class="text-sm text-gray-500">Last reviewed: November 2025</span></div></header><main class="py-12"><div class="container mx-auto px-6 max-w-5xl space-y-12"><section><div class="flex items-center space-x-3 mb-4"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-10 w-10 text-blue-600"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"></path></svg><div><h1 class="text-3xl font-bold text-gray-900">FlashBank Router Security Review</h1><p class="text-gray-600">WETH-first, wallet-custodied liquidity · Internal audit + automated tests</p></div></div><div class="flex flex-wrap gap-3 mb-6"><span class="px-4 py-2 bg-yellow-100 text-yellow-800 rounded-lg flex items-center text-sm font-medium"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4 mr-2"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path><path d="M12 9v4"></path><path d="M12 17h.01"></path></svg> Self-audited (external review pending)</span><span class="px-4 py-2 bg-green-100 text-green-800 rounded-lg flex items-center text-sm font-medium"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4 mr-2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><path d="m9 11 3 3L22 4"></path></svg> 62 automated security tests</span><span class="px-4 py-2 bg-blue-100 text-blue-800 rounded-lg flex items-center text-sm font-medium"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4 mr-2"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg> Non-upgradeable · Owner cannot move user funds</span></div><div class="flex flex-wrap gap-4"><a href="https://github.com/flashbank-net/flashbank/blob/main/contracts/FlashBankRouter.sol" target="_blank" rel="noopener noreferrer" class="inline-flex items-center px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4 mr-2"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" x2="8" y1="13" y2="13"></line><line x1="16" x2="8" y1="17" y2="17"></line><line x1="10" x2="8" y1="9" y2="9"></line></svg> Source (FlashBankRouter.sol)<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-3 w-3 ml-2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" x2="21" y1="14" y2="3"></line></svg></a><a href="https://sepolia.etherscan.io/address/0x3E17aDAd1ec99F9cA0c767f06a02D047b3722D94#code" target="_blank" rel="noopener noreferrer" class="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4 mr-2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" x2="21" y1="14" y2="3"></line></svg> Verified on Etherscan</a></div></section><section><h2 class="text-2xl font-bold text-gray-900 mb-4">Key Safeguards</h2><div class="grid md:grid-cols-2 gap-6"><div class="border border-gray-200 rounded-lg p-5 bg-gray-50"><h3 class="font-semibold text-gray-900 mb-2">Wallet-Custodied Liquidity</h3><p class="text-sm text-gray-600 leading-relaxed">Providers keep WETH in their own wallets. The router can only pull funds for the duration of a flash loan and must return the exact amount plus fee before the transaction ends.</p></div><div class="border border-gray-200 rounded-lg p-5 bg-gray-50"><h3 class="font-semibold text-gray-900 mb-2">Fee &amp; Borrow Clamps</h3><p class="text-sm text-gray-600 leading-relaxed">Per-token fee must stay between 0.01% and 1%. Each flash loan can draw at most a configurable percentage of the total pool (default 50%), preventing whale monopolisation.</p></div><div class="border border-gray-200 rounded-lg p-5 bg-gray-50"><h3 class="font-semibold text-gray-900 mb-2">Permit + Allowance Safety</h3><p class="text-sm text-gray-600 leading-relaxed">Providers may use ERC-20 permit or standard approval. Commitment state lives entirely on-chain, so changing wallets or revoking approvals leaves no hidden liabilities.</p></div><div class="border border-gray-200 rounded-lg p-5 bg-gray-50"><h3 class="font-semibold text-gray-900 mb-2">FlashLoanFailed Guard</h3><p class="text-sm text-gray-600 leading-relaxed">If the borrower fails to repay principal + fee in the same transaction, the router reverts everything. Providers’ balances never change on a failed borrow.</p></div></div></section><section class="space-y-6"><h2 class="text-2xl font-bold text-gray-900">Critical Code Paths</h2><div class="grid md:grid-cols-2 gap-6"><div class="border border-gray-200 rounded-lg overflow-hidden"><div class="px-5 py-3 bg-gray-50 border-b border-gray-200 font-semibold text-gray-800">Per-Token Config &amp; Limits</div><div class="p-5 bg-gray-900 text-gray-100 font-mono text-xs overflow-x-auto"><pre>struct TokenConfig {
    bool enabled;
    bool supportsPermit;
    uint16 feeBps;           // 0.01% – 1%
    uint256 maxFlashLoan;    // absolute cap
    address wrapper;         // WETH or native bridge
    uint16 maxBorrowBps;     // % of pool borrowable in one tx
}</pre></div></div><div class="border border-gray-200 rounded-lg overflow-hidden"><div class="px-5 py-3 bg-gray-50 border-b border-gray-200 font-semibold text-gray-800">Flash Loan Guard</div><div class="p-5 bg-gray-900 text-gray-100 font-mono text-xs overflow-x-auto"><pre>uint256 maxBorrow = Math.mulDiv(
    totalCommitted[token],
    config.maxBorrowBps,
    FEE_DENOMINATOR
);
if (amount &gt; maxBorrow) revert ExceedsMaxBorrowLimit();</pre></div></div></div><p class="text-sm text-gray-600">Unlimited commitments previously risked overflowing <code>totalCommitted * maxBorrowBps</code>. We now calculate borrow caps with<code>Math.mulDiv</code>, ensuring the percentage guard holds for any pool size.</p></section><section><h2 class="text-2xl font-bold text-gray-900 mb-4">Recent Findings &amp; Fixes</h2><div class="grid md:grid-cols-2 gap-6"><div class="border border-green-200 bg-green-50 rounded-lg p-5"><div class="text-xs uppercase tracking-wide text-green-700 font-semibold">Medium<!-- --> impact</div><h3 class="text-lg font-semibold text-green-900 mt-1 mb-2">Unlimited Commitment Overflow</h3><p class="text-sm text-green-800 leading-relaxed">Summing unlimited commitments could overflow when calculating maxBorrowBps. Fixed in v2 by switching to OpenZeppelin Math.mulDiv for safe percentage math.</p></div><div class="border border-green-200 bg-green-50 rounded-lg p-5"><div class="text-xs uppercase tracking-wide text-green-700 font-semibold">Low<!-- --> impact</div><h3 class="text-lg font-semibold text-green-900 mt-1 mb-2">Demo Theft Proof</h3><p class="text-sm text-green-800 leading-relaxed">Fail demo now intentionally reverts on mainnet and the UI records it as an expected “blocked” borrow instead of surfacing a scary error.</p></div></div></section><section><h2 class="text-2xl font-bold text-gray-900 mb-4">Attack Scenarios &amp; Mitigations</h2><div class="space-y-4"><div class="border border-gray-200 rounded-lg p-5"><div class="flex items-start space-x-3 mb-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5 text-red-600 flex-shrink-0"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path><path d="M12 9v4"></path><path d="M12 17h.01"></path></svg><div><h3 class="text-lg font-semibold text-gray-900">Arithmetic Overflow</h3><p class="text-sm text-gray-600"><strong>Threat:</strong> <!-- -->Unlimited commitments multiplied by pool percentages could overflow and allow an attacker to bypass per-loan caps.</p></div></div><div class="bg-green-50 border-l-4 border-green-400 p-4 text-sm text-green-800"><strong>Mitigation:</strong> <!-- -->Router now uses Math.mulDiv(totalCommitted, maxBorrowBps, 10_000). Unlimited commitments stay safe and max borrow logic cannot be bypassed.</div></div><div class="border border-gray-200 rounded-lg p-5"><div class="flex items-start space-x-3 mb-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5 text-red-600 flex-shrink-0"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path><path d="M12 9v4"></path><path d="M12 17h.01"></path></svg><div><h3 class="text-lg font-semibold text-gray-900">Liquidity Theft via Demo Borrower</h3><p class="text-sm text-gray-600"><strong>Threat:</strong> <!-- -->A malicious demo borrower could try to keep the flash loaned ETH and return nothing.</p></div></div><div class="bg-green-50 border-l-4 border-green-400 p-4 text-sm text-green-800"><strong>Mitigation:</strong> <!-- -->Router enforces repayment. The fail demo contract intentionally withholds funds to prove the FlashLoanFailed revert path.</div></div><div class="border border-gray-200 rounded-lg p-5"><div class="flex items-start space-x-3 mb-2"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5 text-red-600 flex-shrink-0"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path><path d="M12 9v4"></path><path d="M12 17h.01"></path></svg><div><h3 class="text-lg font-semibold text-gray-900">Front-running &amp; MEV</h3><p class="text-sm text-gray-600"><strong>Threat:</strong> <!-- -->Attackers may front-run profitable loans or grief providers.</p></div></div><div class="bg-green-50 border-l-4 border-green-400 p-4 text-sm text-green-800"><strong>Mitigation:</strong> <!-- -->Fees are clamped low, max borrow percentages distribute fills across multiple providers, and operators can use private RPC/MEV protection when necessary.</div></div></div></section><section><h2 class="text-2xl font-bold text-gray-900 mb-4">Open Risks</h2><div class="space-y-4"><div class="bg-yellow-50 border-l-4 border-yellow-400 p-5"><h3 class="font-semibold text-yellow-900 mb-1">No External Audit Yet</h3><p class="text-sm text-yellow-800 leading-relaxed">This is a self-audited release. We encourage independent audits before mainnet liquidity is added.</p></div><div class="bg-yellow-50 border-l-4 border-yellow-400 p-5"><h3 class="font-semibold text-yellow-900 mb-1">Allowance Management</h3><p class="text-sm text-yellow-800 leading-relaxed">If a provider approves unlimited WETH and forgets to set/clear commitments, the router could still pull funds for flash loans. The UI defaults to “Unlimited” but makes the commitment explicit to mitigate confusion.</p></div><div class="bg-yellow-50 border-l-4 border-yellow-400 p-5"><h3 class="font-semibold text-yellow-900 mb-1">Borrower DoS</h3><p class="text-sm text-yellow-800 leading-relaxed">Large flash loans could still revert if the borrower’s downstream call fails. This is inherent to flash loans; downstream contracts must be carefully audited.</p></div></div></section><section><h2 class="text-2xl font-bold text-gray-900 mb-4">Testing &amp; Verification</h2><div class="grid md:grid-cols-2 gap-6"><div class="border border-blue-200 bg-blue-50 rounded-lg p-6"><h3 class="font-semibold text-blue-900 mb-3">Automated Coverage</h3><ul class="space-y-2 text-sm text-blue-800"><li>✓ 62 Hardhat/Foundry tests</li><li>✓ Dedicated failure-path tests (FlashLoanFailed, paused router)</li><li>✓ Demo borrower integration tests</li></ul></div><div class="border border-purple-200 bg-purple-50 rounded-lg p-6"><h3 class="font-semibold text-purple-900 mb-3">Manual Review Checklist</h3><ul class="space-y-2 text-sm text-purple-800"><li>✓ Verified bytecode on Etherscan</li><li>✓ Checked owner cannot drain WETH</li><li>✓ Ensured Math.mulDiv guards unlimited commitments</li></ul></div></div></section><section><h2 class="text-2xl font-bold text-gray-900 mb-4">Bug Bounty &amp; Contact</h2><div class="bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200 rounded-lg p-8 flex flex-col md:flex-row md:items-center md:justify-between gap-4"><div><p class="text-gray-700 mb-2">Found something concerning? Please disclose responsibly.</p><p class="text-sm text-gray-600">Critical issues are rewarded. Provide reproduction steps, impact analysis, and recommended fixes.</p></div><div class="flex gap-3"><a href="mailto:security@flashbank.net" class="inline-flex items-center px-5 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm font-semibold"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4 mr-2"><path d="m8 2 1.88 1.88"></path><path d="M14.12 3.88 16 2"></path><path d="M9 7.13v-1a3.003 3.003 0 1 1 6 0v1"></path><path d="M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6"></path><path d="M12 20v-9"></path><path d="M6.53 9C4.6 8.8 3 7.1 3 5"></path><path d="M6 13H2"></path><path d="M3 21c0-2.1 1.7-3.9 3.8-4"></path><path d="M20.97 5c0 2.1-1.6 3.8-3.5 4"></path><path d="M22 13h-4"></path><path d="M17.2 17c2.1.1 3.8 1.9 3.8 4"></path></svg> Report Vulnerability</a><a href="https://github.com/flashbank-net/flashbank/security" target="_blank" rel="noopener noreferrer" class="inline-flex items-center px-5 py-3 border border-gray-300 rounded-lg text-sm font-semibold text-gray-700 hover:bg-gray-50"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4 mr-2"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" x2="8" y1="13" y2="13"></line><line x1="16" x2="8" y1="17" y2="17"></line><line x1="10" x2="8" y1="9" y2="9"></line></svg> Security Policy</a></div></div></section></div></main></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/security-audit","query":{},"buildId":"sd4-ywU21MzRMPpMbbUnn","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>